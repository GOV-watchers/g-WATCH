WITH MHI AS (
    SELECT * FROM {{ ref('stg_mhi') }}
),
MHP AS (
    SELECT * FROM {{ ref('stg_mhp') }}
)

SELECT 
    MHI.MHI_ID AS ID,
    MHI.MHI_BY_YEAR AS YEAR, 
    MHI.MHI,
    (MHP.MHP*.05) AS FIVE_DOWNPAYMENT,
    MHP.MHP,
    SUBSTRING(ROUND((FIVE_DOWNPAYMENT/MHI.MHI)*1920, 0),1,3) AS HOUR_FOR_PAYMENT
FROM MHI
JOIN MHP ON MHP.MHP_BY_YEAR = MHI.MHI_BY_YEAR
WHERE MHP.MHP_BY_YEAR >= '1980' AND MHP.MHP_BY_YEAR <= '2020'
ORDER BY MHP.MHP_BY_YEAR