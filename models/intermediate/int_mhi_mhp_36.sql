WITH MHI AS (
    SELECT * FROM {{ ref('stg_mhi') }}
),
MHP AS (
    SELECT * FROM {{ ref('stg_mhp')}}
)

SELECT 
    MHP.MHP_ID AS ID,
    MHP.MHP_BY_YEAR AS YEAR,
    MHP.MHP,
    CAST(MHI.MHI AS VARCHAR(10)) || '.00' AS MHI,
    CAST(ROUND((MHI*.36), 3) AS DECIMAL(10,2)) AS THIRTY_SIX_PERCENT,
    SUBSTRING((ROUND((MHP/THIRTY_SIX_PERCENT), 2)*1920),1 ,5)  AS HOURS_TO_PURCHASE,
    SUBSTRING(ROUND((MHP/THIRTY_SIX_PERCENT*1920/8), 0),1,4) AS WORKING_DAYS_TO_PURCHASE,
    SUBSTRING(ROUND(MHP/THIRTY_SIX_PERCENT*1920/40), 1,5) AS WEEKLY_TO_PURCHASE,
    SUBSTRING(ROUND(MHP/THIRTY_SIX_PERCENT*1920/160), 1,3) AS MONTHLY_TO_PURCHASE,
    SUBSTRING(ROUND(MHP/THIRTY_SIX_PERCENT*1920/1920), 1, 2) AS YEARLY_T0_PURCHASE
FROM MHP
JOIN MHI ON MHI.MHI_BY_YEAR = MHP.MHP_BY_YEAR
WHERE MHP.MHP_BY_YEAR >= '1980' AND MHP.MHP_BY_YEAR <= '2020'
ORDER BY MHP.MHP_BY_YEAR